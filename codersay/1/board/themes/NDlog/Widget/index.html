<!doctype html>
<html>
	<head>
		<title>{:C('SITE_TITLE')}</title>
		<meta charset="utf-8" />
		<include file="Public:commonjs" />
		<link rel="stylesheet" type="text/css" href="../Public/style/layout.css" />
		<link rel="stylesheet" type="text/css" href="__JS__/jQuery/jQuery_ui/themes/base/jquery-ui.css" /> 
		<script type="text/javascript" src="__JS__/jQuery/jquery.js"></script>
		<script type="text/javascript" src="__JS__/jQuery/plugin/cookie.js"></script>
		<script type="text/javascript" src="__JS__/jQuery/jQuery_ui/ui/jquery-ui.js"></script>
		<script type="text/javascript" src="__JS__/NDlogpublic.js"></script>
		<script type="text/javascript" src="../Public/js/common.js"></script>
		<script type="text/javascript">
			(function($) {
			  	$.fn.outerHTML = function() {
			    	return $(this).clone().wrap('<div></div>').parent().html();
			  	}
			})(jQuery);
			
			jQuery(document).ready(function($){
				$('a.closeEl').bind('click', toggleContent);
				$("#offWidget, #onWidget").sortable({
					connectWith: ['.connectedSortable']
				});
			});
			var toggleContent = function(e){
				var targetContent = $('div.itemContent', this.parentNode.parentNode);
				var title = $(this).find('.title').outerHTML();
				if (targetContent.css('display') == 'none') {
					targetContent.slideDown(300);
					$(this).html(title+'[-]');
				} else {
					targetContent.slideUp(300);
					$(this).html(title+'[+]');
				}
				return false;
			};

			function serialize(){
				var offWidget='';
				$("#offWidget li").each(function(){
					offWidget += 'offWidget[]='+$(this).attr('id')+'&';
				});
				$("#off").attr("value",offWidget);

				var onWidget='';
				$("#onWidget li").each(function(){
					onWidget += 'onWidget[]='+$(this).attr('id')+'&';
				});
				$("#on").attr("value",onWidget);
				
				$("#widgetForm").submit();
			}
		</script>
		<style type="text/css" media="all">
			#offWidget, #onWidget { list-style-type: none; margin: 0; padding: 0; float: left; margin-right: 10px; width: 32%; }
			#offWidget li, #onWidget li { margin: 0px 0px 20px 0px; width: 220px; }
			.itemHeader{ padding: 7px 11px; border-bottom: 1px solid #ddd; background: #eee; }
			.itemContent { padding:10px 13px; }
			.ui-state-default {
				background:#fff repeat-x scroll 50% 50%;
				border:1px solid #CCCCCC;
				font-weight:bold;
				outline-color:-moz-use-text-color;
				outline-style:none;
				outline-width:medium;
			}
		</style>
	</head>
	<body>
		<div id="wrap">
			<include file="Public:header" />
			<div id="container">
				<div id="sidebar_switch"></div>
				<div id="content">
					<div id="c_warp">
						<div style="width: 32%; margin-left: 1%; margin:0 1% 20px 0; float: left;"><h4>未启用的Widget</h4></div>
						<div style="width: 32%; margin-left: 1%; margin:0 1% 20px 0; float: left;"><h4>已启用的Widget</h4></div>
						<div class="clear"></div>
						<ul id="offWidget" class="connectedSortable">
						<volist name="offWidget" id="off">
							<li id="{$off.id}" class="ui-state-default">
								<div class="itemHeader"><a href="#" class="closeEl"><span class="title">{$off.title} - {$off.name|Input::forShow}</span>[-]</a></div>
								<div class="itemContent">
								{$off.remark|Input::forShow}
								</div>
							</li>
						</volist>
						</ul>
						<ul id="onWidget" class="connectedSortable">
						<volist name="onWidget" id="on">
							<li id="{$on.id}" class="ui-state-default">
								<div class="itemHeader"><a href="#" class="closeEl"><span class="title">{$on.title} - {$on.name|Input::forShow}</span>[-]</a></div>
								<div class="itemContent">
								{$on.remark|Input::forShow}
								</div>
							</li>
						</volist>
						</ul>
						<div class="clear"></div>
						<form id="widgetForm" method="POST" action="{:U('widgetConfig')}">
							<input name="offWidget" id="off" type="hidden">
							<input name="onWidget" id="on" type="hidden">
							<input type="button" class="submit" value="保存" onclick="serialize()">
						</form>
					</div>
				</div>
				<include file="Public:sidebar" />
			</div>
		</div>
	</body>
</html>