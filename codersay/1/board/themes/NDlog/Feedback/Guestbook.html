<!doctype html>
<html>
	<head>
		<title>{:C('SITE_TITLE')}</title>
		<meta charset="utf-8" />
		<include file="Public:commonjs" />
		<link rel="stylesheet" type="text/css" href="../Public/style/layout.css" />
		<script type="text/javascript" src="__JS__/jQuery/jquery.js"></script>
		<script type="text/javascript" src="__JS__/jQuery/plugin/cookie.js"></script>
		<script type="text/javascript" src="__JS__/NDlogpublic.js"></script>
		<script type="text/javascript" src="../Public/js/common.js"></script>
		<script type="text/javascript">
			jQuery(document).ready(function($){
				NDlog._setTableStyle( 'input[name="all"]', 'input[name="ids[]"]', '.rows_style' );
				$('.del_guestbook').click(function(){
        			var _self = $(this);
        			$.confirm('确定要删除ID为"'+_self.attr('rel')+'"的留言么？',function(){
        				window.location.href = _self.attr('href');
        			},function(){
        				
        			});
        			return false;
        		});

                $('#selectall').click(function(){
                    //
                    if ( $(this).attr('checked') ){
                        $('input[name="list[]"]').attr('checked','checked');
                    }else{
                        $('input[name="list[]"]').removeAttr('checked');
                    }
                });
        		
        		$('.guestbook_reply').click(function(){
        		    var _self = $(this);
        		    var _url  = _self.attr('href');
        		    var _reply = $.dialog({
        		        title : '回复留言',
        		        lock : true
        		    });
        		    $.ajax({
        		        url : _url,
        		        success : function(e){
        		            _reply.content(e);
        		            var _form = $('body').find('#insert_guestbook');
        		            var _editor = _form.find('#reply_content');
        		            var _editor1 = KindEditor.create(_editor,{
        		                items : [
                                    'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
                                    'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                                    'insertunorderedlist', '|', 'emoticons', 'link']
        		            });
        		            _form.find('#submit_guestbook').live('click',function(){
        		                if ( _editor1.text() == '' ){
        		                    alert('请填写回复内容！');
        		                    return false;
        		                }
        		            });
        		        },
        		        cache : false
        		    });
                    return false;
        		});
			});
		</script>
		<style type="text/css" media="all">
			input{ vertical-align: middle; }
			dl.reply                    { border : 1px solid #e1e7f4; background:#f0f5ff; margin:5px; padding : 10px 15px; }
		</style>
	</head>
	<body>
		<div id="wrap">
			<include file="Public:header" />
			<div id="container">
				<div id="sidebar_switch"></div>
				<div id="content">
					<div id="c_warp">
			            <form action="{:U('actBatch')}" method="post">
		                <input type="hidden" name="type" value="{$type}" />
		                <div class="button" style="margin-bottom:15px;">
		                    <input type="submit" value="批量屏蔽" name="Disable" class="submit raction" style="margin-right: 15px;" />
		                    <input type="submit" value="批量恢复" name="Enabled" class="submit raction" style="margin-right: 15px;" />
		                    <input type="submit" value="批量删除" name="Delete" class="submit raction" />
		                </div>
		                <table width="100%" cellpadding="0" cellspacing="0" border="0" class="table_list">
		                    <tr>
		                        <th align="center" width="20"><input type="checkbox" name="all" /></th>
		                        <th width="90" align="center">留言人</th>
		                        <th align="center">留言内容</th>
		                        <th width="100" align="center">留言时间</th>
		                        <th width="90" align="center">操作</th>
		                    </tr>
		                    <volist id="vo" name="list">
		                    <tr rel="{$vo['id']}" class="rows_style"<?php if( ( $i % 2 ) == 0 ){ ?> bgcolor="#f9f9f9"<?php }else{ ?> bgcolor="#ffffff"<?php } ?>>
		                        <td align="center"><input type="checkbox" name="ids[]" value="{$vo.id}" /></td>
		                        <td align="center">{$vo.username}</td>
		                        <td>
		                            {$vo.content}
		                            <?php
		                                $reply_list = $model->where("pid='".$vo['id']."'")->select();
		                                foreach($reply_list as $key => $val){
		                            ?>
		                            <dl class="reply">
		                                <dt>{$val.username} 于 {$val.create_time|date=C('DEFAULT_DATE_FORMAT'),###} 回复 {$vo.username}</dt>
		                                <dd>{$val.content}</dd>
		                            </dl>
		                            <?php
		                                }
		                            ?>
		                            
		                        </td>
		                        <td align="center">{$vo.create_time|date=C('DEFAULT_DATE_FORMAT'),###}</td>
		                        <td align="center"><a href="{:U('delete',array('id' => $vo['id'], 'node' => $_GET['node'], 'type' => $type))}" class="del_node" rel="{$vo.id}">删除</a><span class="c_line">|</span><a href="{:U('reply',array('id' => $vo['id'], 'node' => $_GET['node'], 'type' => $type))}" class="del_node" rel="{$vo.id}">回复</a></td>
		                    </tr>
		                    </volist>
		                </table>
		                </form>
						<div class="page">{$page}</div>
					</div>
				</div>
				<include file="Public:sidebar" />
			</div>
		</div>
	</body>
</html>